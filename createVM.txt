# Create VM using powershell

$PSVersionTable.PSVersion

Get-ExecutionPolicy -List

Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser

Install-Module -Name Az -Repository PSGallery -Force

Update-Module -Name AZ -Force

Connect-AzAccount

New-AZVm `
  -ResourceGroupName "myrg" `
  -Name "VM01" `
  -Location "centralIndia" `
  -Image "" `
  -VirtualNetworkName "" `
  -SubnetName "" `
  -SecurityGroupName "" `
  -PublicIpAddressName "" `
  -OpenPorts 80,22

Get-AzVMSize -Location "CentralIndia"

Remove-AZResourceGroup -Name $rg

Invoke-WebRequest -Uri https://aka.ms/installazurecliwindows -OutFile .\AzureCLI.msi

Start-Process msiexec.exe -Wait -ArgumentList '/I AzureCLI.msi /quiet

rm ./AzureCLI.msi


az login

az account show

az account list --output table

az account set --subscription <mysubscriptionname>

az group create --name centralindia --location centralindia

az vm list-sizes --location centralindia --output table -- command is about to deprecate

az vm list-skus --l centralindia --resource-type availabilitySets

az vm get-instance-view --name vm01 --resource-group mg --query instanceView.statuses[1] --output table

az vm deallocate --resource-group myrg --name VM01

az vm start --resource-group myrg --name vm01

az vm run-command invoke --resource-group myrg --name vm01 --command-id RunShellScript --scripts "sudo apt-get update && sudo apt-get install -y nginx

az vm list-ip-addresses --resource-group myrg --name vm01 --output table

az vm open-port --port 80 --resource-group myrg --name vm01

az group delete --name myrg --no-wait --force --verbose

